<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Compagnies de bus | cam137</title>
<meta name="keywords" content="Informatique, Aventure">
<meta name="description" content="Je cherchais un moyen de récupérer tous les mails des sociétés de transports de la région Nouvelle-Aquitaine. 
Pour ça je suis allé sur le site de la Fédération National des Transports de Voyageurs qui propose un annuaire de leurs adhérents. 
Ensuite j&rsquo;ai remarqué qu&rsquo;on pouvait filtrer et, parmi les résultats, cliquer sur &ldquo;voir la fiche&rdquo; pour afficher une petite fenêtre avec les informations de la compagnie. 
Le problème c&rsquo;est que l&rsquo;URL ne change pas. Même pas quand on applique des filtres. Vous sentez la douille ? 
Naturellement, les boutons &ldquo;Voir la fiche&rdquo; n&rsquo;apparaissent pas dans le code source de la page. Tout se faisait par script JS. 
Lorsque le bouton est cliqué, un fichier JS envoie une requête pour récupérer un fichier JSON avec toutes les infos et afficher tout ça correctement. 
Le code JS est écrit sur une seule ligne et fait 76848 caractères donc autant vous dire que j&rsquo;irai pas lire le truc. ">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/mail_bus/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.36819bea596090d8b48cf10d9831382996197aa7e4fc86f792f7c08c9ca4d23b.css" integrity="sha256-NoGb6llgkNi0jPENmDE4KZYZeqfk/Ib3kvfAjJyk0js=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/mail_bus/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="cam137 (Alt + H)">cam137</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/categories/" title="Catégories">
                    <span>Catégories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Rechercher">
                    <span>Rechercher</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="À propos">
                    <span>À propos</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Compagnies de bus
    </h1>
    <div class="post-meta"><span title='2025-07-11 10:08:30 +0200 CEST'>July 11, 2025</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#m%c3%a9thode" aria-label="Méthode">Méthode</a></li>
                <li>
                    <a href="#pourquoi-fonctionner-comme-%c3%a7a-" aria-label="Pourquoi fonctionner comme ça ?">Pourquoi fonctionner comme ça ?</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Je cherchais un moyen de récupérer tous les mails des sociétés de transports de la région Nouvelle-Aquitaine. <!-- raw HTML omitted -->
Pour ça je suis allé sur le site de la Fédération National des Transports de Voyageurs qui propose un annuaire de leurs adhérents. <!-- raw HTML omitted -->
Ensuite j&rsquo;ai remarqué qu&rsquo;on pouvait filtrer et, parmi les résultats, cliquer sur &ldquo;voir la fiche&rdquo; pour afficher une petite fenêtre avec les informations de la compagnie. <!-- raw HTML omitted -->
Le problème c&rsquo;est que l&rsquo;URL ne change pas. Même pas quand on applique des filtres. Vous sentez la douille ? <!-- raw HTML omitted -->
Naturellement, les boutons &ldquo;Voir la fiche&rdquo; n&rsquo;apparaissent pas dans le code source de la page. Tout se faisait par script JS. <!-- raw HTML omitted -->
Lorsque le bouton est cliqué, un fichier JS envoie une requête pour récupérer un fichier JSON avec toutes les infos et afficher tout ça correctement. <!-- raw HTML omitted -->
Le code JS est écrit sur une seule ligne et fait 76848 caractères donc autant vous dire que j&rsquo;irai pas lire le truc. <!-- raw HTML omitted --></p>
<h2 id="méthode">Méthode<a hidden class="anchor" aria-hidden="true" href="#méthode">#</a></h2>
<p>D&rsquo;abord j&rsquo;ai regardé les requêtes et j&rsquo;ai compris quel fichier se compilait en cliquant sur des boutons bien précis. <!-- raw HTML omitted -->
Ensuite il suffisait de récupérer la réponse de la requête qui est ni plus ni moins qu&rsquo;un JSON avec TOUTES les infos lol. <!-- raw HTML omitted -->
Le JSON se présente comme ça :</p>
<pre tabindex="0"><code>{&#39;total&#39;: int,
 &#39;totalPages&#39;: int,
 &#39;data&#39;: [{&#39;id&#39;: int,
   &#39;name&#39;: str,
   &#39;type&#39;: str,
   &#39;sub_type&#39;: str,
   &#39;regional_union&#39;: str,
   &#39;phone&#39;: str,
   &#39;email&#39;: str,
   &#39;zipCode&#39;: str,
   &#39;address&#39;: str,
   &#39;city&#39;: str,
   &#39;latitude&#39;: float,
   &#39;longitude&#39;: float,
   &#39;helper_days&#39;: None,
   &#39;helper_time&#39;: None}, 
		{...}]}
</code></pre><p>Et après ce que je veux c&rsquo;est le nom de la compagnie ainsi que le mail pour pouvoir copier coller ça dans un excel et envoyer un mail à tout le monde en même temps. <!-- raw HTML omitted -->
Pour cela, il suffit d&rsquo;un script python :</p>
<pre tabindex="0"><code>import pandas as pd
import json

with open(&#39;blabla.json&#39;) as f:
    data = json.load(f)[&#39;data&#39;]

df = pd.DataFrame([[d[&#39;name&#39;], d[&#39;email&#39;]] for d in data], columns=[&#39;Nom&#39;, &#39;Mail&#39;])
df.to_excel(&#34;output.xlsx&#34;, index=False)
</code></pre><h2 id="pourquoi-fonctionner-comme-ça-">Pourquoi fonctionner comme ça ?<a hidden class="anchor" aria-hidden="true" href="#pourquoi-fonctionner-comme-ça-">#</a></h2>
<p>Déjà c&rsquo;est plus léger parce que le backend envoie que des données et pas de HTML entier mais en réalité est-ce que ça change grand chose ?
Dans tous les cas on dépassera pas Netflix en bande passante. <!-- raw HTML omitted --></p>
<p>L&rsquo;idée de traiter de la donnée c&rsquo;est que c&rsquo;est beaucoup plus modulable et facile à adapter pour un appareil mobile ou une appli.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/informatique/">Informatique</a></li>
      <li><a href="http://localhost:1313/tags/aventure/">Aventure</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>© Mathéo Milley-Arjaliès</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
